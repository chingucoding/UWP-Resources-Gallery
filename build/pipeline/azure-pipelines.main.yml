# Universal Windows Platform
# Build a Universal Windows Platform project using Visual Studio.
# Add steps that test and distribute an app, save build artifacts, and more:
# https://aka.ms/yaml

trigger:
- master

pool:
  vmImage: 'windows-2019'

variables:
  solution: '**/*.sln'
  buildPlatform: 'x86'
  buildConfiguration: 'Debug'
  appxPackageDir: '$(build.artifactStagingDirectory)\AppxPackages\\'

stages:
  - stage: Build
    jobs:
      - template: ./templates/build-template.yml
        parameters:
          buildPlatform: 'x86'
          buildConfiguration: 'Debug'
  
  - stage: Testing
    dependsOn: Build
    jobs:
      - template: ./templates/test-unit-tests.yml
        parameters:
          buildPlatform: 'x86'
          buildConfiguration: 'Debug'        

      - template: ./templates/test-interaction-tests.yml
        parameters:
          buildPlatform: 'x86'
          buildConfiguration: 'Debug'

  - stage: Publish
    dependsOn: Testing
    jobs:
      - job: Publish_Release
        displayName: Release Build
        steps:
        - task: NuGetToolInstaller@1

        - task: NuGetCommand@2
          inputs:
            restoreSolution: '$(solution)'
        - task: VSBuild@1
          inputs:
            platform: 'x86'
            solution: '$(solution)'
            configuration: 'Release'
            msbuildArgs: '/p:AppxBundlePlatforms="$(buildPlatform)" /p:AppxPackageDir="$(appxPackageDir)" /p:AppxBundle=Always /p:UapAppxPackageBuildMode=StoreUpload /p:AppxPackageSigningEnabled=true'
        
        - task: PublishPipelineArtifact@1
          inputs:
            targetPath: '$(System.DefaultWorkingDirectory)\artifacts\Release\'
            artifact: 'Release_$(buildPlatform)'
            publishLocation: 'pipeline'
